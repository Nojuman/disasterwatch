var locDate=new Date(),utcDate=new Date(locDate.getTime()+(locDate.getTimezoneOffset()*60000)),scope={basemap:"mapbox",current_date:moment(locDate).format("YYYY-MM-DD")},avail_basemap={VIIRS_SNPP_CorrectedReflectance_TrueColor:"SUOMI NPP True Color (CR)","VIIRS_SNPP_CorrectedReflectance_BandsM11-I2-I1":"SUOMI NPP Bands M11-I2-I1 (CR)","VIIRS_SNPP_CorrectedReflectance_BandsM3-I3-M11":"SUOMI NPP Bands M3-I3-I11 (CR)",MODIS_Terra_CorrectedReflectance_TrueColor:"Terra True Color (CR)",MODIS_Terra_CorrectedReflectance_Bands721:"Terra Bands 7-2-1 (CR)",MODIS_Terra_CorrectedReflectance_Bands367:"Terra Bands 3-6-7 (CR)",MODIS_Aqua_CorrectedReflectance_TrueColor:"Aqua True Color (CR)",MODIS_Aqua_CorrectedReflectance_Bands721:"Aqua Bands 7-2-1 (CR)",MODIS_Terra_Land_Surface_Temp_Day:"Terra Surface T째 (Day)",MODIS_Terra_Land_Surface_Temp_Night:"Terra Surface T째 (Night)",MODIS_Aqua_Land_Surface_Temp_Day:"Aqua Surface T째 (Day)",MODIS_Aqua_Land_Surface_Temp_Night:"Aqua Surface T째 (Night)",mapbox:"mapbox"};var map=L.map("map",{zoomControl:false,attributionControl:false,scrollWheelZoom:true,inertia:false,minZoom:2,maxZoom:9}),icon_inactive=L.icon({iconUrl:"../img/volcano_rest.png",iconAnchor:[10,40],iconSize:[20,40]}),icon_warning=L.icon({iconUrl:"../img/volcano_warn.png",iconAnchor:[20,80],iconSize:[40,80]}),icon_active=L.icon({iconUrl:"../img/volcano_act.png",iconAnchor:[20,80],iconSize:[40,80]}),volcanoesGroup=new L.featureGroup().addTo(map),seismesGroup=new L.featureGroup().addTo(map),fireGroup=new L.layerGroup(),lyrGr=new L.layerGroup().addTo(map);L.control.attribution({prefix:"<a href='http://remotepixel.ca/' target='_blank'>&copy; RemotePixel",position:"bottomright"}).addTo(map);fireGroup.addLayer(L.tileLayer.wms("https://firms.modaps.eosdis.nasa.gov/wms/",{layers:"fires24",format:"image/PNG",transparent:true,zIndex:100000,attribution:""}));volcanoesGroup.on("click",function(a){a.layer.bindPopup('<div class="nom-eq">Name: '+a.layer.properties.Name+'</div><div class="linetab">Status: '+a.layer.properties.vw.status+'</div><div class="linetab">Last Update: '+a.layer.properties.vw.update+'</div><div class="linetab">Sources: '+a.layer.properties.vw.sources+'</div><div class="linetab">Volcano Type: '+a.layer.properties.Type+'</div><div class="linetab">Volcano Num: '+a.layer.properties.Number+'</div><div class="linetab">Elevation: '+a.layer.properties.Elevation+'m</div><div class="linetab">Country: '+a.layer.properties.Country+'</div><div class="linetab"><a target="_blank" href="http://volcano.si.edu/volcano.cfm?vn='+a.layer.properties.Number+'">Info</a></div>').openPopup()});seismesGroup.on("click",function(a){console.log(a.layer.properties);a.layer.bindPopup('<div class="nom-eq">Name: '+a.layer.properties.title+'</div><div class="linetab">Date: '+moment(a.layer.properties.time).utc().format("YYYY-MM-DD HH:mm:ss")+'(UTC)</div><div class="linetab">Magnitude: '+a.layer.properties.mag+'</div><div class="linetab">Felt: '+((a.layer.properties.felt===null)?"No":"Yes")+'</div><div class="linetab">Duration (min): '+a.layer.properties.dmin+'</div><div class="linetab">Tsunami: '+((a.layer.properties.tsunami===0)?"No":"Yes")+'</div><div class="linetab"><a target="_blank" href="'+a.layer.properties.url+'">Info</a></div>').openPopup()});L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{attribution:"Map Data: <a href='http://www.mapbox.com/about/maps/' target='_blank'>&copy; Mapbox &copy; OpenStreetMap</a>",id:"vincentsarago.3a6fdab2",accessToken:"pk.eyJ1IjoidmluY2VudHNhcmFnbyIsImEiOiIwMjYwZDQ3ZDVhZGM2ZjQzNzg2MTQzY2I2NjA1ZjU2ZCJ9.eTehNUtH3zlcrTbTUQ-fdg"}).addTo(map);var j,option;for(j=0;j<volcanoes.length;j+=1){if(volcanoes[j].vw.active===0){continue}switch(volcanoes[j].vw.status){case"inactive":option={icon:icon_inactive,title:volcanoes[j].Name};break;case"warning":option={icon:icon_warning,title:volcanoes[j].Name};break;case"active":option={icon:icon_active,title:volcanoes[j].Name};break;case null:option={icon:icon_inactive,title:volcanoes[j].Name};break}var vol=L.marker([volcanoes[j].Lat,volcanoes[j].Lon],option);vol.properties=volcanoes[j];volcanoesGroup.addLayer(vol)}new L.Control.Zoom({position:"bottomright"}).addTo(map);map.setView([0,0],2);var mini_map_option={zoom:2,keyboard:false,touchZoom:false,scrollWheelZoom:false,doubleClickZoom:false,boxZoom:false,dragging:false,tap:false,attributionControl:false,zoomControl:false,inertia:false,minZoom:2,maxZoom:10,center:[1,1]};var minimap0=L.map("map-default",mini_map_option);minimap0.dragging.disable();L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{id:"vincentsarago.3a6fdab2",accessToken:"pk.eyJ1IjoidmluY2VudHNhcmFnbyIsImEiOiJjaWlleG1vdmowMWhydGtrc2xqcmQzNmhlIn0.80HAFLCQ6yUWCk4mwm6zbw"}).addTo(minimap0);map.sync(minimap0);var minimap1=L.map("map-terra-true",mini_map_option);map.sync(minimap1);var minimap1_lyr=L.layerGroup().addTo(minimap1);var minimap2=L.map("map-terra-721",mini_map_option);map.sync(minimap2);var minimap2_lyr=L.layerGroup().addTo(minimap2);var minimap3=L.map("map-terra-367",mini_map_option);map.sync(minimap3);var minimap3_lyr=L.layerGroup().addTo(minimap3);var minimap4=L.map("map-aqua-true",mini_map_option);map.sync(minimap4);var minimap4_lyr=L.layerGroup().addTo(minimap4);var minimap5=L.map("map-aqua-721",mini_map_option);map.sync(minimap5);var minimap5_lyr=L.layerGroup().addTo(minimap5);var minimap6=L.map("map-suomi-true",mini_map_option);map.sync(minimap6);var minimap6_lyr=L.layerGroup().addTo(minimap6);var minimap7=L.map("map-suomi-1121",mini_map_option);map.sync(minimap7);var minimap7_lyr=L.layerGroup().addTo(minimap7);var minimap8=L.map("map-suomi-3311",mini_map_option);map.sync(minimap8);var minimap8_lyr=L.layerGroup().addTo(minimap8);$("#earthquake-checkbox").change(function(){$("#earthquake-checkbox").parent().toggleClass("green");if(map.hasLayer(seismesGroup)){map.removeLayer(seismesGroup)}else{map.addLayer(seismesGroup)}});$("#fire-checkbox").change(function(){$("#fire-checkbox").parent().toggleClass("green");if(map.hasLayer(fireGroup)){map.removeLayer(fireGroup)}else{map.addLayer(fireGroup)}});$("#volcanoes-checkbox").change(function(){$("#volcanoes-checkbox").parent().toggleClass("green");if(map.hasLayer(volcanoesGroup)){map.removeLayer(volcanoesGroup)}else{map.addLayer(volcanoesGroup)}});function getSeismes(){seismesGroup.clearLayers();var a="http://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime="+scope.current_date+"&endtime="+moment(scope.current_date,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD");$.getJSON(a,function(b){b.features.forEach(function(d){var c=L.circleMarker([d.geometry.coordinates[1],d.geometry.coordinates[0]],{color:"#3b74f2",radius:d.properties.mag*2,weight:2,opacity:1,fill:true});c.properties=d.properties;seismesGroup.addLayer(c)})})}function toggleParam(a){switch(a){case"basemaps":$("#settings-panel").removeClass("on");$("#settings-btn").removeClass("on");$("#basemaps-panel").toggleClass("on");$("#basemaps-btn").toggleClass("on");break;case"settings":$("#basemaps-panel").removeClass("on");$("#basemaps-btn").removeClass("on");$("#settings-panel").toggleClass("on");$("#settings-btn").toggleClass("on");break;case"add":$("#settings-panel").removeClass("on");$("#settings-btn").removeClass("on");$("#basemaps-panel").removeClass("on");$("#basemaps-btn").removeClass("on");break;case null:break}}function changeOverlay(a){scope.basemap=a;lyrGr.clearLayers();if(scope.basemap!=="mapbox"){lyrGr.addLayer(L.GIBSLayer(scope.basemap,{date:scope.current_date,transparent:true,attribution:'Imagery: <a href="https://earthdata.nasa.gov/gibs">NASA EOSDIS GIBS</a>'}));lyrGr.addLayer(L.GIBSLayer("Coastlines",{zIndex:1000}))}$("#right-id").text("Right: "+avail_basemap[scope.right_data])}function updateminimap(){var a={date:scope.current_date,transparent:scope.transparent_modis};minimap1_lyr.clearLayers();minimap2_lyr.clearLayers();minimap3_lyr.clearLayers();minimap4_lyr.clearLayers();minimap5_lyr.clearLayers();minimap6_lyr.clearLayers();minimap7_lyr.clearLayers();minimap8_lyr.clearLayers();minimap1_lyr.addLayer(L.GIBSLayer("MODIS_Terra_CorrectedReflectance_TrueColor",a));minimap2_lyr.addLayer(L.GIBSLayer("MODIS_Terra_CorrectedReflectance_Bands721",a));minimap3_lyr.addLayer(L.GIBSLayer("MODIS_Terra_CorrectedReflectance_Bands367",a));minimap4_lyr.addLayer(L.GIBSLayer("MODIS_Aqua_CorrectedReflectance_TrueColor",a));minimap5_lyr.addLayer(L.GIBSLayer("MODIS_Aqua_CorrectedReflectance_Bands721",a));minimap6_lyr.addLayer(L.GIBSLayer("VIIRS_SNPP_CorrectedReflectance_TrueColor",a));minimap7_lyr.addLayer(L.GIBSLayer("VIIRS_SNPP_CorrectedReflectance_BandsM11-I2-I1",a));minimap8_lyr.addLayer(L.GIBSLayer("VIIRS_SNPP_CorrectedReflectance_BandsM3-I3-M11",a))}$(document).ready(function(){getSeismes();$(".date-button").text(scope.current_date);updateminimap();$(".date-button").datepicker({format:"mm/dd/yyyy",autoclose:true,todayHighlight:true,startDate:new Date("2012-05-08"),endDate:utcDate}).on("changeDate",function(a){scope.current_date=moment(a.date).format("YYYY-MM-DD");$(".date-button").text(scope.current_date);changeOverlay(scope.basemap);updateminimap()})});