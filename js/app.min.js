var map=new mapboxgl.Map({container:"map",center:[0,10],zoom:1,attributionControl:true,minZoom:0,maxZoom:8}),draw=mapboxgl.Draw({displayControlsDefault:false,});map.dragRotate.disable();map.touchZoomRotate.disableRotation();map.addControl(draw);map.addControl(new mapboxgl.Navigation());mapboxgl.accessToken="pk.eyJ1IjoidmluY2VudHNhcmFnbyIsImEiOiJjaWlleG1vdmowMWhydGtrc2xqcmQzNmhlIn0.80HAFLCQ6yUWCk4mwm6zbw";map.on("style.load",function(){var a={type:"FeatureCollection",features:[]};map.addSource("earthquakes",{type:"geojson",data:a});getEarthquake();var b="hsl(26, 89%, 44%)";map.addLayer({id:"earthquakes-blur",type:"circle",source:"earthquakes",maxzoom:9,layout:{visibility:"none"},paint:{"circle-color":b,"circle-opacity":0.5,"circle-radius":{property:"mag",base:1.8,stops:[[{zoom:0,value:2},0.25],[{zoom:0,value:8},16],[{zoom:9,value:2},10],[{zoom:9,value:8},100]]},"circle-color":{property:"mag",stops:[["4.5","#fff"],["8","#f00"]]}}});map.addLayer({id:"earthquakes-point",type:"circle",source:"earthquakes",layout:{visibility:"none"},paint:{"circle-color":"rgb(23, 14, 3)","circle-radius":{base:1.1,stops:[[0,0.5],[8,3]]}},});if(document.getElementById("earthquake-checkbox").checked){map.setLayoutProperty("earthquakes-point","visibility","visible");map.setLayoutProperty("earthquakes-blur","visibility","visible")}else{map.setLayoutProperty("earthquakes-point","visibility","none");map.setLayoutProperty("earthquakes-blur","visibility","none")}map.on("mousemove",function(d){var f=1;if(map.getLayer("earthquakes-point").getLayoutProperty("visibility")!=="none"){var c=map.queryRenderedFeatures([[d.point.x-f,d.point.y-f],[d.point.x+f,d.point.y+f]],{layers:["earthquakes-point"]})[0];if(c){map.getCanvas().style.cursor="pointer"}else{map.getCanvas().style.cursor="inherit"}}}).on("click",function(f){var g=1;if(map.getLayer("earthquakes-point").getLayoutProperty("visibility")!=="none"){var d=map.queryRenderedFeatures([[f.point.x-g,f.point.y-g],[f.point.x+g,f.point.y+g]],{layers:["earthquakes-point"]})[0];if(d){var c=new mapboxgl.Popup().setLngLat(f.lngLat).setHTML('<div class="nom-eq">Name: '+d.properties.title+'</div><div class="linetab">Date: '+moment(d.properties.time).utc().format("YYYY-MM-DD HH:mm:ss")+'(UTC)</div><div class="linetab">Magnitude: '+d.properties.mag+'</div><div class="linetab">Felt: '+((d.properties.felt===null)?"No":"Yes")+'</div><div class="linetab">Duration (min): '+d.properties.dmin+'</div><div class="linetab">Tsunami: '+((d.properties.tsunami===0)?"No":"Yes")+'</div><div class="linetab"><a target="_blank" href="'+d.properties.url+'">Info</a></div>').addTo(map)}}})});map.on("draw.create",function(a){console.log(a)});$("#earthquake-checkbox").change(function(){$("#earthquake-checkbox").parent().toggleClass("green");if(document.getElementById("earthquake-checkbox").checked){map.setLayoutProperty("earthquakes-point","visibility","visible");map.setLayoutProperty("earthquakes-blur","visibility","visible")}else{map.setLayoutProperty("earthquakes-point","visibility","none");map.setLayoutProperty("earthquakes-blur","visibility","none")}});function getEarthquake(){var a="http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/4.5_week.geojson";$.get("https://u4h2tjydjl.execute-api.us-west-2.amazonaws.com/remotepixel/https?url="+a).done(function(b){map.getSource("earthquakes").setData(b)})}function drawOnMap(a){draw.deleteAll();switch(a){case"point":draw.changeMode("draw_point");break;case"polygon":draw.changeMode("draw_polygon");break;case null:break}}function toggleParam(a){switch(a){case"basemaps":$("#settings-panel").removeClass("on");$("#settings-btn").removeClass("on");$("#basemaps-panel").toggleClass("on");$("#basemaps-btn").toggleClass("on");break;case"settings":$("#basemaps-panel").removeClass("on");$("#basemaps-btn").removeClass("on");$("#settings-panel").toggleClass("on");$("#settings-btn").toggleClass("on");break;case"add":$("#settings-panel").removeClass("on");$("#settings-btn").removeClass("on");$("#basemaps-panel").removeClass("on");$("#basemaps-btn").removeClass("on");break;case null:break}}function getStyle(d){var a=document.getElementsByClassName("date-button")[0].textContent;switch(d){case"MapboxMap":$(".date-button").attr("disabled","disabled");var b="mapbox://styles/mapbox/light-v9";break;case"MapboxSat":$(".date-button").attr("disabled","disabled");var b="mapbox://styles/mapbox/satellite-streets-v9";break;default:$(".date-button").attr("disabled",false);var c="https://map1.vis.earthdata.nasa.gov/wmts-webmerc/"+d+"/default/"+a+"/GoogleMapsCompatible_Level9/{z}/{y}/{x}.jpg",b={version:8,sources:{"gibs-tiles":{type:"raster",tiles:[c],attribution:[' <a href="http://openstreetmap.com">&copy; OpenStreetMap</a>  <a href="https://earthdata.nasa.gov/about/science-system-description/eosdis-components/global-imagery-browse-services-gibs" >NASA EOSDIS GIBS</a>'],tileSize:256}},layers:[{id:"gibs-tiles",type:"raster",source:"gibs-tiles",minZoom:1,maxZoom:9}]};b.sources.coast={type:"raster",tiles:["https://map1.vis.earthdata.nasa.gov/wmts-webmerc/Reference_Features/default/0/GoogleMapsCompatible_Level9/{z}/{y}/{x}.png",],tileSize:256};b.sources.places={type:"raster",tiles:["https://map1.vis.earthdata.nasa.gov/wmts-webmerc/Reference_Labels/default/0/GoogleMapsCompatible_Level9/{z}/{y}/{x}.png",],tileSize:256};b.layers.push({id:"coast",type:"raster",source:"coast",minZoom:1,maxZoom:8});b.layers.push({id:"places",type:"raster",source:"places",minZoom:1,maxZoom:8})}return b}function changeOverlay(a){$("#basemaps-panel .side-view-content .side-element .link-on").each(function(){$(this).removeClass("on")});$("#"+a+" .link-on").addClass("on");map.setStyle(getStyle(a))}function update_basemaps(){var a=document.getElementsByClassName("link-on on")[0].parentElement.getAttribute("id");map.setStyle(getStyle(a))}$(document).ready(function(){$(".date-button").datepicker({format:"yyyy-mm-dd",autoclose:true,todayHighlight:true,startDate:"2012-05-08",endDate:moment.utc().format("YYYY-MM-DD")}).on("changeDate",function(d){var c=moment(d.date).format("YYYY-MM-DD"),b=document.getElementsByClassName("link-on on")[0].parentElement.getAttribute("id");$(".date-button").text(c);if(moment(c).isBefore("2015-11-24")){var a=b.slice(0,5);if(a=="VIIRS"){changeOverlay("MODIS_Terra_CorrectedReflectance_TrueColor")}}update_basemaps()});$(".date-button").datepicker("setDate",moment.utc().subtract(1,"days").format("YYYY-MM-DD"))});